# ヒアリングシステムUXレビュー (#HEAR-001)

## 実施日: 2025-10-21

---

## 1. 既存システム概要

### 1.1 リポジトリ情報
- **URL:** https://github.com/itoksk/hearing
- **目的:** 生徒の相談内容をAIで分析し、レポートを生成するシステム
- **想定利用者:** 生徒、教員、外部講師

### 1.2 想定されるフロー（requirements.mdより）
1. **相談入力** - 生徒が相談テーマと詳細を入力
2. **AI処理** - OpenAI GPT APIで要約・分析
3. **自己評価** - 生徒が成功/課題/次の一手を記入
4. **レポート生成** - PDF/Markdown/JSON形式で出力
5. **共有** - 教員・外部講師向けダッシュボードで閲覧

---

## 2. 踏襲すべき要素

### 2.1 UIフロー
✅ **良い点:**
- シンプルで直感的なステップ形式
- 生徒が自分で振り返る仕組み（自己評価）
- 複数形式でのレポート出力（PDF/Markdown/JSON）

**踏襲すべき設計:**
```
ステップ1: 相談テーマ選択
  ↓
ステップ2: 詳細入力（自由記述）
  ↓
ステップ3: AI回答表示
  ↓
ステップ4: 自己評価入力
  - 成功したこと
  - 課題
  - 次の一手
  ↓
ステップ5: レポート生成・共有
```

### 2.2 データ構造
✅ **良い点:**
- 相談ログを構造化して保存
- AI回答と生徒の自己評価を両方記録
- 授業回単位で束ねる設計

**踏襲すべきデータ構造:**
```javascript
{
  consultationId: "uuid",
  studentId: "student@seig-boys.jp",
  timestamp: "2025-10-21T10:00:00Z",
  lessonNumber: 3,
  theme: "ベクトルと追尾AI",
  details: "敵が追いかけてこない...",
  aiResponse: "...",
  selfEvaluation: {
    success: "...",
    challenges: "...",
    nextSteps: "..."
  },
  status: "completed"
}
```

### 2.3 認証とアクセス制御
✅ **良い点:**
- 学校ドメイン（@seig-boys.jp）でのGoogle OAuth認証
- ロール別アクセス（生徒/教員/外部講師）

---

## 3. 改善点

### 3.1 UI/UXの改善

#### 問題点1: 相談テーマの選択が難しい
**現状:** 自由記述のみ
**改善案:**
- プリセットテーマ選択 + カスタム入力
- 授業回との紐付け（第3回なら「ベクトル×追尾AI」を推奨）
- 過去の相談履歴からサジェスト

**実装イメージ:**
```html
<select id="themePreset">
  <option value="">カスタムテーマ</option>
  <option value="unity-error">Unityエラー</option>
  <option value="vector-math">ベクトル・数学</option>
  <option value="asset-usage">素材の使い方</option>
  <option value="game-design">ゲーム設計</option>
</select>
<input type="text" id="customTheme" placeholder="または自由入力...">
```

---

#### 問題点2: AI回答待ち時間のフィードバック不足
**現状:** ローディング表示のみ
**改善案:**
- プログレスバー表示
- 処理ステップの表示（「要約中...」「AI分析中...」「レポート生成中...」）
- 推定待ち時間の表示

**実装イメージ:**
```html
<div class="progress-container">
  <div class="progress-bar" id="progressBar"></div>
  <p id="progressMessage">要約中... (10〜20秒)</p>
</div>
```

---

#### 問題点3: 自己評価の書き方がわからない
**現状:** プレースホルダーのみ
**改善案:**
- 例文の表示
- 入力ガイドのツールチップ
- 最小文字数の推奨

**実装イメージ:**
```html
<label for="success">
  成功したこと
  <span class="tooltip">💡 例: 「エラーメッセージの意味を理解できた」</span>
</label>
<textarea id="success" placeholder="具体的に記入してください（30文字以上推奨）"></textarea>
```

---

#### 問題点4: レポート共有方法が不明確
**現状:** ダウンロードのみ
**改善案:**
- 共有リンク生成（期限付き）
- 教員ダッシュボードへの自動送信
- メール通知（オプション）

---

### 3.2 データ設計の改善

#### 問題点5: 関連リソースとの紐付けが弱い
**現状:** テキストのみ
**改善案:**
- `resources.json`のリソースIDと紐付け
- AI回答に推奨リソースを自動付与
- Gemツールへの誘導

**改善後のデータ構造:**
```javascript
{
  // ... 既存フィールド
  recommendedResources: [
    { id: "gem-001", reason: "エラー解決に役立ちます" },
    { id: "code-002", reason: "追尾AIのコード例です" },
    { id: "theme-003", reason: "ベクトルの学習テーマ" }
  ],
  relatedGems: ["gem-001", "gem-002"]
}
```

---

#### 問題点6: 頻出課題の抽出が手動
**現状:** 教員が手動でログを読む
**改善案:**
- タグ自動抽出（AI分析時）
- 頻出キーワードの集計
- FAQへの自動反映フロー

**実装:**
```javascript
{
  // ... 既存フィールド
  extractedTags: ["NullReferenceException", "追尾AI", "ベクトル"],
  difficulty: "medium", // AI判定
  resolved: true
}
```

---

### 3.3 セキュリティ・プライバシーの改善

#### 問題点7: PII（個人情報）フィルタが不十分
**現状:** 生徒が自由入力
**改善案:**
- 入力時の注意喚起
- AI送信前のPIIフィルタ（名前、住所、電話番号等）
- 匿名化処理

**実装:**
```javascript
function filterPII(text) {
  // 名前パターン（簡易版）
  text = text.replace(/[一-龥]{2,4}さん?/g, "[生徒名]");
  // 電話番号
  text = text.replace(/\d{2,4}-\d{2,4}-\d{4}/g, "[電話番号]");
  // メールアドレス
  text = text.replace(/[\w\.-]+@[\w\.-]+\.\w+/g, "[メールアドレス]");
  return text;
}
```

---

#### 問題点8: ログ保持期間が未定義
**現状:** 無期限保存
**改善案:**
- 学期末後3ヶ月で自動削除（設定可能）
- 匿名化処理後は統計データとして保持
- 削除前の確認フロー

---

### 3.4 運用面の改善

#### 問題点9: 教員ダッシュボードの機能不足
**現状:** 相談ログ一覧のみ
**改善案:**
- 授業回別フィルタ
- 未解決/解決済みステータス
- よくある質問の自動抽出
- CSV/JSONエクスポート

**ダッシュボード機能:**
```
[フィルタ]
- 授業回: 第3回
- ステータス: 未解決
- 期間: 2025-10-01 ~ 2025-10-31

[表示]
- 相談件数: 45件
- 未解決: 5件
- よくあるテーマ: ①ベクトル（12件） ②エラー（8件）

[アクション]
- CSVエクスポート
- FAQに追加
- 一括レポート生成
```

---

#### 問題点10: オフライン対応がない
**現状:** オンライン必須
**改善案:**
- ローカルストレージに一時保存
- オンライン復帰時に同期
- オフライン時の明確なメッセージ

---

## 4. 技術スタック推奨

### 4.1 フロントエンド
- **フレームワーク:** Next.js 14（App Router）
  - SSR/SSGで高速表示
  - Vercelと相性が良い
  - TypeScript標準対応

- **UI:** TailwindCSS + shadcn/ui
  - 授業ハブサイトとデザイン統一
  - アクセシビリティ対応済み
  - コンポーネント再利用

- **状態管理:** React Context API
  - 小規模アプリに適切
  - 追加ライブラリ不要

### 4.2 バックエンド
- **API:** Next.js API Routes
  - フロントエンドと統合
  - サーバーレス関数で実行
  - OpenAI API呼び出しを隠蔽

- **認証:** NextAuth.js
  - Google OAuth対応
  - セッション管理
  - ドメイン制限（@seig-boys.jp、@itoksk.com）

### 4.3 データベース
- **Firestore:** リアルタイムDB
  - スケーラビリティ
  - Security Rulesでアクセス制御
  - オフライン同期

### 4.4 ホスティング
- **Vercel:** Next.jsホスティング
  - 自動デプロイ（GitHub連携）
  - Edge Functions
  - 環境変数管理

---

## 5. ワイヤーフレーム

### 5.1 相談入力画面
```
┌─────────────────────────────────────────┐
│ [ヘッダー] 相談ヒアリング               │
└─────────────────────────────────────────┘

ステップ 1/5: 相談テーマを選択

授業回: [第3回 ▼]

テーマ:
┌─────────────────────────────────────────┐
│ ○ ベクトル×追尾AI（推奨）               │
│ ○ Unityエラー                           │
│ ○ 素材の使い方                          │
│ ○ ゲーム設計                            │
│ ○ その他: [____________]                │
└─────────────────────────────────────────┘

[次へ >]
```

---

### 5.2 詳細入力画面
```
ステップ 2/5: 詳細を入力

相談内容を具体的に記入してください:
┌─────────────────────────────────────────┐
│                                         │
│ [自由記述エリア]                         │
│                                         │
│ 💡 ヒント:                              │
│ - どんな問題が起きていますか？          │
│ - どこまで試しましたか？                │
│ - エラーメッセージがあれば貼り付けて    │
│                                         │
└─────────────────────────────────────────┘

[< 戻る]  [AIに相談 >]
```

---

### 5.3 AI回答表示画面
```
ステップ 3/5: AI回答

┌─────────────────────────────────────────┐
│ 🤖 AI分析結果                            │
│                                         │
│ [AI回答の内容]                          │
│                                         │
│ 💡 推奨リソース:                         │
│ • unity-debug-mentor で詳しく診断      │
│ • コード例: EnemyChaser                 │
│ • 学習テーマ: ベクトル×追尾            │
└─────────────────────────────────────────┘

この回答は役に立ちましたか？
[👍 はい]  [👎 いいえ]

[< 戻る]  [次へ >]
```

---

### 5.4 自己評価入力画面
```
ステップ 4/5: 振り返り

成功したこと:
┌─────────────────────────────────────────┐
│ [具体的に記入]                          │
└─────────────────────────────────────────┘

課題・まだわからないこと:
┌─────────────────────────────────────────┐
│ [具体的に記入]                          │
└─────────────────────────────────────────┘

次にやること:
┌─────────────────────────────────────────┐
│ [具体的に記入]                          │
└─────────────────────────────────────────┘

[< 戻る]  [レポート作成 >]
```

---

### 5.5 レポート生成・共有画面
```
ステップ 5/5: レポート

✅ レポートが作成されました！

┌─────────────────────────────────────────┐
│ 相談ID: #12345                          │
│ 日時: 2025-10-21 10:30                  │
│ テーマ: ベクトル×追尾AI                 │
│                                         │
│ [レポートプレビュー]                    │
└─────────────────────────────────────────┘

ダウンロード:
[PDF] [Markdown] [JSON]

共有:
[📧 教員に送信]  [🔗 共有リンク作成]

[完了]
```

---

## 6. 教員ダッシュボード

```
┌─────────────────────────────────────────┐
│ [ヘッダー] 相談ダッシュボード（教員）    │
└─────────────────────────────────────────┘

フィルタ:
授業回: [第3回 ▼]  期間: [2025-10-01 ~ 31]
ステータス: [全て ▼]

─────────────────────────────────────────

統計:
• 総相談件数: 45件
• 未解決: 5件
• 解決済: 40件

よくあるテーマ:
1. ベクトル×追尾AI (12件)
2. Unityエラー (8件)
3. 素材の使い方 (6件)

─────────────────────────────────────────

相談一覧:
┌───┬────────┬──────┬────┬────┐
│ID │ 日時    │テーマ│生徒│状態│
├───┼────────┼──────┼────┼────┤
│123│10/21 10│ベクト│A君 │解決│
│124│10/21 11│エラー│B君 │未解│
└───┴────────┴──────┴────┴────┘

[CSVエクスポート] [FAQに追加] [レポート生成]
```

---

## 7. 次のアクションアイテム

- [ ] #HEAR-002: OpenAI GPT API設計（プロンプトテンプレート、コスト試算）
- [ ] #HEAR-003: Firestoreストレージ設計
- [ ] #HEAR-004: Firebase Security Rules作成
- [ ] #HEAR-005: Vercelデプロイ環境構築

---

## 8. まとめ

### 踏襲すべき要素
✅ シンプルなステップ形式のフロー
✅ 生徒の自己評価を含むレポート構造
✅ 学校ドメイン認証

### 改善すべき要素
⚠️ 相談テーマのサジェスト機能
⚠️ リソースとの紐付け強化
⚠️ PIIフィルタ・ログ保持期間
⚠️ 教員ダッシュボードの機能拡充
⚠️ オフライン対応

### 推奨技術スタック
📌 Next.js 14 + TypeScript
📌 NextAuth.js (Google OAuth)
📌 Firestore + Security Rules
📌 Vercel Hosting
