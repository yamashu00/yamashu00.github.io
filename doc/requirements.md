# 要件定義
## 全体
- 対象は高校2年生（Unity/C#初学者）と教員・外部講師。全体で「迷わせず、次の行動を示す」体験を提供する。
- サイト・Gem・ヒアリングシステムで共通タグ体系と教材メタデータを共有し、横断検索を可能にする。
- 主要リソース（教材・Gem・相談ログ）をGitHub Pages/リポジトリ由来のデータで管理し、更新履歴を透明化する。

## 授業ハブサイト
- トップにキーワード検索とクリエイター絞り込みを配置し、入力補完とタグ候補提示を行う。
- 授業フェーズ（導入/開発/仕上げ）と学習テーマ（数学/プログラミング/デザイン/知財）の二軸カードを表示。
- 更新頻度の高いリンク（LOTTE素材、Google Drive資料、指導案PDF）は更新日タグとバージョン情報を併記。
- 授業ステップをタイムライン化し、各ステップごとに必須教材・推奨Gem・想定アウトプットをまとめる。
- 更新情報セクション（新設予定、`/updates`ページとして公開予定）でサイト更新ログ・Gemリリースノート・ヒアリング機能更新を発信。
- JSON/FrontMatterなど静的データ構造を整備し、外部から利用しやすい形式で提供する。

## Gemスイート
- 各Gemはカスタム指示に役割・ペルソナ・対応範囲・非対応範囲・回答スタイルを明示する。
- Gem共通のデータ取得レイヤーを持ち、ハブサイトの教材フィードや更新情報を参照できる。
- すべてのGemは授業ハブサイトにカードとして埋め込み、サイト閲覧中の生徒が即時アクセスできるようにする。
- 生徒向けGem（例:`unity-debug-mentor`）ではステップごとの指示と検証方法、教員向けGem（例:`lesson-scheduler`）では授業準備タスクと資料リンクを提示。
- コマンドライン利用を前提に、オフラインキャッシュやタイムアウト時のフォールバック手順を整える。
- Gemの導入手順（環境構築、APIキー不要）をサイトとGem両方で案内し、Windows/Mac双方をサポート。
- ヒアリングシステムとは別運用とし、Gemは授業サイト上の教材・資料のみを参照する。ログ共有が必要な場合はユーザーが手動で行う。
- Gemは外部リンクを直接提示できない前提で設計し、必要な参照先は教材名・階層・更新情報などのテキストとして指示に含める。

## ヒアリングシステム
- `hearing`のUI/UXを参考に、生徒が相談テーマ→詳細→AI回答→自己評価（成功/課題/次の一手）を入力するフローを提供。
- AI応答はOpenAI GPT API（例: GPT-4o mini / GPT-4.1など用途に応じたモデル）を利用し、要約→API呼び出し→レポート整形→保存までをサーバー側で実行。
- レポートはPDF/Markdown/JSONで出力でき、生徒は即共有リンクまたはダウンロードが可能。
- 認証は学校ドメイン（`@seig-boys.jp`）のGoogleアカウントで実施し、アクセス権限をロール（生徒/教員/外部講師）ごとに制御する。
- 相談ログやレポートはFirestoreに保存し、教員・外部講師向けのダッシュボードから授業回単位に閲覧できる。
- バックエンド実装はGitHubのhttps://github.com/itoksk/hearing をベースにカスタマイズし、Vercel上で運用する。
- プライバシーポリシー/同意フローを明示し、PIIの収集・保存最小化とログ保持期間を設定。

## データ・セキュリティ
- APIキーはサーバー側で集中管理し、生徒端末に露出させない。アクセスは学校アカウント等で制御。
- 相談ログに対してPIIフィルタや禁止ワードチェックを実施し、OpenAI送信前にクレンジングする。
- Firestoreに保存するデータにはアクセス制御ルール（Firebase Security Rules）を設定し、ドメイン認証済みユーザーのみ閲覧可能にする。
- 相談ログや教材フィードはGit版管理され、変更差分をレビュー可能にする。
- 利用状況に応じてAPIコストを管理（レート制限、トークン上限、要約処理）し、異常時のアラートを設置。

## 技術・運用
- ハブサイトはGitHub Pagesをベースに`royal-fortress-template`を活用しつつ、必要なCSS/JS拡張を行う。
- ヒアリングバックエンドはスクール環境（例: Cloud Run/AWS Lambda）で運用できる構成とし、将来的なGem API化を想定。
- 運用ドキュメント（更新手順、問い合わせ対応、AI品質改善フロー）を整備する。
- ユーザーテスト（生徒・教員）を定期的に実施し、フィードバックからサイト/Gem/AIの改善サイクルを回す。
