# Gem共通テンプレート見直しと改善提案 (#GEM-001)

## 実施日: 2025-10-21

---

## 1. 現状評価

### 既存のGemカスタム指示（doc/gem-instructions.md）
✅ **良い点:**
- 全6つのGemに対して詳細なカスタム指示が既に作成済み
- 日本語テンプレート構造が統一されている
- 命令書・指示・制約条件・背景情報・出力形式・具体例・要点の7つのセクションで構成
- 授業ハブサイトとの連携を前提とした設計
- 外部リンクを直接提示できない制約を考慮

⚠️ **改善の余地:**
- ペルソナ別ユースケースとの対応付けが明示的でない
- 関連リソース（resources.json内のID）へのリンクが含まれていない
- 更新情報セクション（/updates）への案内が含まれていない

---

## 2. 共通テンプレート改善案

### 2.1 追加すべきセクション

#### セクション8: ペルソナとユースケース（新規）
```markdown
# ペルソナとユースケース
* **主な対象ペルソナ:** [生徒（プログラマー）/生徒（デザイナー）/生徒（プランナー）/教員/TA]
* **使用頻度:** [高/中/低]
* **主なユースケース:**
  - UC-XXX: [ユースケース名]
  - UC-XXX: [ユースケース名]
```

#### セクション9: 関連リソース（新規）
```markdown
# 関連リソース
* **リソースID参照:** [resource-001, code-001, theme-001...]
* **他のGem:** [gem-002, gem-004...]
* **最新情報:** 更新情報は「/updates」ページで確認してください
```

### 2.2 背景情報セクションの強化

**追加すべき情報:**
- リソースJSONのID体系の説明
- 授業サイトの構造（検索機能、フィルタ機能の使い方）
- 他のGemとの使い分け

---

## 3. Gem別改善提案

### gem-001: unity-debug-mentor
**現状:** ✅ 既に高品質なカスタム指示あり

**改善提案:**
1. **ペルソナ追加:**
   - 主な対象: 生徒（プログラマー）
   - 使用頻度: 高
   - UC-001: エラーを解決する

2. **関連リソース追加:**
   ```markdown
   * リソースID: code-001 (PlayerController), code-002 (EnemyChaser)
   * 他のGem: gem-002 (vector-math-coach) - ベクトル関連のエラー時
   ```

3. **出力形式に追加:**
   ```markdown
   ## 次の一手
   - [具体的な次のアクション]
   - 💡 関連リソース: 授業ハブ「検索」で「[キーワード]」を検索
   ```

---

### gem-002: vector-math-coach
**現状:** ✅ 既に高品質なカスタム指示あり

**改善提案:**
1. **ペルソナ追加:**
   - 主な対象: 生徒（プログラマー）、生徒（プランナー）
   - 使用頻度: 中
   - UC-003: 数学の概念をゲームに応用する
   - UC-007: ガチャの確率設計をする

2. **関連リソース追加:**
   ```markdown
   * リソースID: theme-001, theme-002, theme-003, code-002, code-003
   * 参考資料: resource-006, resource-007, resource-008, resource-009
   ```

---

### gem-003: asset-handbook
**現状:** ✅ 既に高品質なカスタム指示あり

**改善提案:**
1. **ペルソナ追加:**
   - 主な対象: 生徒（デザイナー）
   - 使用頻度: 中
   - UC-004: LOTTEキャラクターを使う

2. **関連リソース追加:**
   ```markdown
   * リソースID: resource-004 (LOTTEキャラクター素材)
   * Google Driveアクセス: 学校アカウント（@seig-boys.jp）でログイン必須
   ```

---

### gem-004: lesson-scheduler
**現状:** ✅ 既に高品質なカスタム指示あり

**改善提案:**
1. **ペルソナ追加:**
   - 主な対象: 教員、生徒（プランナー）、TA
   - 使用頻度: 中
   - UC-006: チームタスクを管理する
   - UC-008: 授業準備をする

2. **関連リソース追加:**
   ```markdown
   * リソースID: doc-002 (授業スケジュール)
   * 他のGem: 各授業回で推奨されるGemを提示
   ```

---

### gem-005: unity-install-help
**現状:** ✅ 既に高品質なカスタム指示あり

**改善提案:**
1. **ペルソナ追加:**
   - 主な対象: 全生徒
   - 使用頻度: 低（初回のみ）
   - UC-005: Unity環境を構築する

2. **関連リソース追加:**
   ```markdown
   * リソースID: resource-001 (Schoomy開発者の知見)
   * トラブル時: gem-001 (unity-debug-mentor) で環境関連エラーを診断
   ```

---

### gem-006: hearing-reporter
**現状:** ✅ 既に高品質なカスタム指示あり

**改善提案:**
1. **ペルソナ追加:**
   - 主な対象: 教員
   - 使用頻度: 低（週次）
   - UC-009: 生徒の相談ログを分析する

2. **関連リソース追加:**
   ```markdown
   * データソース: Firestoreコレクション（ヒアリングシステム）
   * 推奨教材抽出: resources.jsonから自動マッピング
   ```

---

## 4. 全Gem共通の改善ポイント

### 4.1 禁止事項の明確化

**追加すべき禁止事項:**
```markdown
# 制約条件
* **禁止事項:**
  - 推測のみで断定しない（必ず根拠を示す）
  - 個人情報を記載・要求しない
  - 有償リソース（Asset Store等）を勧めない
  - 授業範囲外の高度な技術を持ち込まない
  - 外部URLを直接提示しない（授業ハブ経由で案内）
```

### 4.2 不足情報の確認フロー

**統一フォーマット:**
```markdown
# 不足情報の確認
もし以下の情報が不足している場合は、必ず具体的に質問してください:
- [Gem固有の必要情報リスト]

質問例: 「○○についてもう少し詳しく教えてください。具体的には...」
```

### 4.3 次の一手の提示

**統一フォーマット:**
```markdown
## 次の一手
1. [具体的な次のアクション]
2. 💡 関連リソース:
   - 授業ハブ「検索」で「[キーワード]」を検索
   - Gem「[gem-xxx]」で「[テーマ]」を相談
3. 📝 振り返り: [振り返りの問いかけ]
```

---

## 5. 実装チェックリスト

### ユーザー作業（教員・TAが実施）

- [ ] **#GEM-002**: unity-debug-mentorの回答品質を検証
  - 典型エラー（NullReferenceException、MissingComponentException等）を実際に入力
  - 提示される原因仮説と修正手順の妥当性を確認
  - 関連リソースの推薦が適切か検証
  - **担当:** TA

- [ ] **#GEM-003**: lesson-schedulerの授業回チェックリスト仕様を定義
  - 各授業回ごとの目標、タスク、必要資料を整理
  - 生徒・教員・TA向けのタスク分担を明確化
  - GitHub Classroom課題との連携方法を決定
  - **担当:** 教員

- [ ] **#GEM-004**: ヒアリングシステムとのAPI連携方針を検討
  - Firestoreコレクション設計の確定
  - Firebase Security Rules（ドメイン限定アクセス）の設定
  - OpenAI GPT API呼び出しフローの実装
  - hearing-reporterとの連携テスト
  - **担当:** 開発チーム

- [ ] **全Gem**: カスタム指示の更新
  - 上記の改善提案をGeminiに反映
  - ペルソナとユースケースセクションを追加
  - 関連リソースIDを追加
  - /updatesページへの案内を追加

### システム側（既に完了）

- [x] 教材メタデータJSON（resources.json）の作成
- [x] リソースID体系の確立
- [x] 授業ハブサイトの検索・フィルタ機能
- [x] Gemカード表示とペルソナ別フィルタ
- [x] /updatesページの作成

---

## 6. Gem更新運用フロー

### 6.1 Gemカスタム指示の更新手順

1. **doc/gem-instructions.mdを編集**
   - 改善提案に基づいてテンプレートを更新
   - ペルソナ、ユースケース、関連リソースを追加

2. **Gemini Gemに反映**
   - https://gemini.google.com/ にアクセス
   - 各GemのURL（gem-instructions.mdに記載）を開く
   - カスタム指示を更新

3. **更新情報を記録**
   - /updates/index.htmlに更新履歴を追加
   - 変更内容、変更理由、影響範囲を記載

4. **resources.jsonを更新**
   - 該当GemのlastUpdatedを更新
   - 必要に応じてdescriptionやuseCasesを更新

### 6.2 定期レビューサイクル

**週次:**
- 生徒からのフィードバック収集（ヒアリングシステム経由）
- よくある質問の抽出と対応検討

**月次:**
- Gemの回答品質レビュー
- カスタム指示の微調整
- 新しいユースケースの追加検討

**学期ごと:**
- 全Gemの大幅見直し
- ペルソナの再定義
- 授業内容の変更に合わせた調整

---

## 7. 成果物

### 完了したドキュメント
- ✅ doc/gem-instructions.md（既存・改善提案を記載）
- ✅ doc/personas-doc002.md（ペルソナとユースケース定義）
- ✅ doc/gem-improvements-gem001.md（本ドキュメント）

### 次のアクション
教員・TAチームが以下を実施:
1. Gemカスタム指示の更新（改善提案を反映）
2. unity-debug-mentorの回答品質検証（#GEM-002）
3. lesson-schedulerの仕様詳細化（#GEM-003）
4. ヒアリングシステムの実装（#GEM-004、#HEAR-001～005）

---

## 8. 補足: Gemのバージョン管理

### バージョニング方針
```
Gem名 v[Major].[Minor].[Patch]

Major: カスタム指示の大幅変更（出力形式変更等）
Minor: 機能追加（新しいユースケース対応等）
Patch: 微調整（誤字修正、表現改善等）
```

### 変更履歴の記録
```markdown
## unity-debug-mentor 変更履歴

### v1.1.0 (2025-10-21)
- ペルソナとユースケースセクションを追加
- 関連リソースIDを追加（code-001, code-002）
- 次の一手に授業ハブ検索案内を追加

### v1.0.0 (2025-10-10)
- 初版リリース
- NullReferenceException、MissingComponentException対応
```

---

## まとめ

既存のGemカスタム指示は高品質で、授業ハブサイトとの連携も考慮されています。

今回の改善提案は、以下の3点を強化するものです：
1. **ペルソナとユースケースの明示** - 誰がどんな時に使うかを明確化
2. **リソース連携の強化** - resources.jsonのIDを活用した横断的な案内
3. **更新運用フローの確立** - 継続的な改善サイクルの構築

**ユーザー（教員・TA）が実施すべき作業:**
- Gemカスタム指示の更新
- 回答品質の検証（#GEM-002）
- ヒアリングシステムの実装（#GEM-004、#HEAR-001～005）
